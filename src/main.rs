mod helpers;

use crate::helpers::to_f64;
use num::{bigint::Sign, rational::Ratio, BigInt, BigRational, FromPrimitive};
use std::str::FromStr;

fn nu(x: &str) -> BigRational {
    BigRational::new(BigInt::from_str(x).unwrap(), BigInt::from_str("1").unwrap())
}

fn main() {
    let a = Ratio::new(
        BigInt::new(
            Sign::Plus,
            vec![
                1978536695, 1640926221, 1646329198, 1960822888, 1886908870, 1573903399, 78209833,
                11263803, 1645764317, 1132380647, 1782544341, 877663277, 2137397623, 917860847,
                1569166410, 3067522609, 1987654360, 1390112556, 2993781269, 3187886481, 1403766675,
                1319400213, 848425762, 964487491, 910281121, 1299612510, 4037544241, 2767369005,
                506259392, 4062444317, 4226740552, 3000039381, 3105924308, 2108326445, 1932928081,
                4129563567, 1449843699, 1074904975, 2498272647, 4144258749, 2770490291, 17863291,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                2386270588, 1858589027, 3393130321, 1954983940, 139303004, 321750667, 733103327,
                1749704033, 1204995077, 684533722, 720511924, 874022307, 266344720, 1833192027,
                3121899001, 2344624615, 2689647538, 2831137116, 3750921091, 1023142637, 2580606203,
                1820230669, 4034825704, 927408832, 3397828193, 3694981029, 2552155054, 2898454282,
                3297830528, 1685959358, 2190262459, 3086741595, 1610077730, 3009465348, 3729129300,
                3777242479, 1566655912, 3065833962, 543858229, 2833308488, 1685787165, 37845859,
            ],
        ),
    );
    let b = Ratio::new(
        BigInt::new(
            Sign::Minus,
            vec![
                722571333, 3300145038, 2476895914, 1991932717, 3448362693, 2895973216, 1790304837,
                3901156621, 1513096066, 1087113938, 1799923742, 2399846468, 3214366050, 1887565952,
                1268344111, 1062028926, 629719650, 2276959285, 231283969, 1793540674, 3132047557,
                753725064, 3710811460, 2133307559, 368657903, 2618762122, 96157618, 1852618350,
                4106981267, 3703175823, 1143492279, 2338158151, 3757692008, 730648032, 3089651149,
                3459994209, 431981912, 3485849371, 2092173162, 1993823158, 3905406090, 2359813391,
                2598725618, 4235465938, 436018729, 6,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                528703656, 3371900769, 1321186946, 3761942427, 660113394, 3977418408, 706157954,
                1602533502, 2438295014, 1067672131, 1175099038, 3508266211, 4181501525, 2163254760,
                3645531249, 345928733, 3029471422, 4261695763, 1727833633, 1960525083, 2799125704,
                2316624318, 322570683, 2912498407, 750843059, 448746134, 3218185141, 1430901603,
                1301028817, 1896232092, 1950976615, 2004249567, 1258981286, 3613615405, 3962933266,
                3705187236, 1637491105, 3657056968, 1484720277, 2807868262, 4272313673, 3591165693,
                2292906201, 3699280483, 934664635, 12,
            ],
        ),
    );
    let c = Ratio::new(
        BigInt::new(
            Sign::Plus,
            vec![
                1821541804, 2062234687, 1060213963, 169080609, 503804449, 2401403199, 357424738,
                4235666362, 776057704, 919408229, 2224830065, 3020436791, 1614652404, 3896039655,
                2315900417, 4288875870, 2821779008, 2797993798, 3841285348, 2344859679, 2989646580,
                3702029284, 1285481688, 1106700002, 1182802598, 2117811537, 1273682146, 963990817,
                815367557, 1738086361, 522138601, 3898753253, 4102543870, 2040625499, 3021562489,
                1172244727, 1030653520, 3814295580, 903217874, 1400303332,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                1122732403, 4222599811, 1791247484, 1565512153, 2449223318, 1549976361, 952661805,
                376063112, 3101183854, 3407615022, 3932138900, 3051602581, 1290224344, 3687290299,
                1531396404, 963841671, 2727445180, 4020455552, 2475445406, 1358473237, 833981575,
                3174121265, 2288401635, 166039006, 3233034471, 2511612851, 1233484087, 10937959,
                2026079242, 1570963569, 1703455117, 1685446810, 1407097873, 2220056482, 907784902,
                1771350742, 2254249272, 2888463379, 2295854881, 2780343644, 11,
            ],
        ),
    );
    let d = Ratio::new(
        BigInt::new(
            Sign::Minus,
            vec![
                1289948649, 804745824, 3971204796, 957445526, 184802108, 1621812588, 1574138253,
                3249092610, 1363204497, 432438731, 207803590, 1097043161, 2242163760, 3115541598,
                2801011679, 1981459895, 2663808315, 794438811, 3113864909, 1730598422, 3629344739,
                2855513818, 4005074102, 3197879665, 2976077592, 1984483716, 720509335, 1133254278,
                1038599967, 658359151, 2825081485, 2775195592, 3506787947, 809097047, 3451836621,
                3766424611, 3769920216, 4116345714, 2299186632, 2009930217, 1023104065, 654918006,
                11626529,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                3814098308, 73409724, 881043763, 229986372, 3543245347, 3444973704, 33655460,
                2605879167, 2631527343, 2309702836, 4062665291, 2122453023, 2428433251, 22388168,
                2638021012, 884817073, 3636131932, 3291328765, 3430496722, 2049638520, 3476769799,
                2104989077, 1871499038, 2724313549, 3028569017, 2570023700, 4050063395, 4030452506,
                2769149689, 1293808653, 2956923402, 747634744, 2794807251, 3868689135, 3654551372,
                1887189498, 3151330506, 3152706249, 3883824656, 1140365405, 3267607919, 266077043,
                2305002187, 4,
            ],
        ),
    );
    let e = Ratio::new(
        BigInt::new(
            Sign::Plus,
            vec![
                3584801317, 3303471206, 3096898167, 1346971804, 738318055, 1601041245, 523249045,
                2510554742, 509700502, 192594313, 3106647963, 3316915084, 177237065, 870910899,
                2568360330, 2184008913, 4014655767, 4111622489, 2008235777, 3117288802, 3198524038,
                2262664032, 1836412908, 1010766149, 648344559, 3327006945, 3109527914, 3617968486,
                1667973671, 2351444453, 1262797106, 1506389956, 828745124, 1505772397, 1443280126,
                1133811937, 4176755466, 4210254204, 2401077413, 541300290, 385874822, 2818092590,
                3365913626, 1293702474, 10347,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                4184194836, 4141495712, 3702212897, 1626516175, 2293221315, 874918299, 2547220702,
                1310359013, 2471843342, 284047256, 666174574, 1492732543, 1638856149, 3726979598,
                233544074, 2283980590, 1731295478, 3788698451, 429786338, 2836758988, 334972361,
                952393982, 2914906426, 1475209960, 4064405780, 3171262603, 473620206, 1431633584,
                3827942579, 1192674639, 2710155583, 4101270677, 415996563, 358927941, 1379782536,
                2761750013, 2321967718, 4276205227, 2317474458, 1724777738, 1767849662, 2253106168,
                1456986660, 3014221420, 1543360946,
            ],
        ),
    );
    let f = Ratio::new(
        BigInt::new(
            Sign::Minus,
            vec![
                4252090201, 2082158114, 3342846813, 3476107526, 2004417085, 3618239789, 592308206,
                3932294417, 2476498313, 2725231676, 254164772, 3223877516, 1551103630, 2086600000,
                4030561826, 1582729693, 2407902569, 553495802, 1131917810, 2728237885, 3234685061,
                3097302884, 1829272186, 1952445202, 545366729, 2527829892, 4227468753, 1618875890,
                3290330761, 3104477301, 1497043080, 224625200, 3043116003, 1394296389, 1811320823,
                3816196252, 2594332369, 3577404105, 2095738584, 1231689508, 43200492,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                1427717623, 498935623, 3839154892, 3388285748, 3855814043, 2792460624, 3282588457,
                1749904640, 4220811788, 3876916795, 1754850899, 3536272353, 2493284853, 178114061,
                3473761611, 1167651659, 1657385288, 430694233, 2627326523, 1724108845, 969884448,
                3040526309, 670713600, 2699268436, 1658544879, 1740932530, 399856107, 1654532521,
                2376939555, 2148969149, 1731804210, 3625747174, 3486081574, 3785752232, 3145613289,
                4081859997, 2584550442, 586080516, 2206380748, 4123816983, 2205531329, 216159,
            ],
        ),
    );
    let g = Ratio::new(
        BigInt::new(
            Sign::Plus,
            vec![
                107652133, 1278305953, 3719255677, 3655279398, 1585365500, 587250878, 3365574586,
                1615660288, 3625367412, 1722458461, 2421574646, 1415443705, 2157028957, 3521581422,
                2324401554, 1136874973, 1075100036, 3205016497, 2120225166, 3157280229, 4193424163,
                4101906136, 1414399942, 2125015121, 1284544670, 1928307664, 2840113859, 512613257,
                552256813, 3059745726, 1189592678, 4208407477, 3647641389, 2525437538, 269919777,
                4107587757, 3178996656, 1174094094, 1446331081, 2448553944, 85996,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                4035707627, 2006813797, 2566286395, 881011132, 4003790522, 1267111943, 1175069323,
                2165905975, 3362717479, 2548232560, 1583478447, 854221542, 1281766644, 3984160941,
                527567668, 3370706804, 3606099954, 1028307011, 2162988917, 1390607545, 3247505153,
                2842782703, 778232337, 4024537446, 2469254450, 93624083, 2337419220, 3169158151,
                74806948, 293418974, 553465763, 3168584908, 2889389070, 1813874836, 2250523091,
                4181549249, 2213662752, 1794553764, 309617105, 2174552646, 1758113377, 91283,
            ],
        ),
    );
    let h = Ratio::new(
        BigInt::new(
            Sign::Minus,
            vec![
                3241213952, 1017259207, 3065729954, 1822594354, 4269462075, 1897985178, 2712696134,
                809193338, 628428638, 3879090673, 1089357754, 2826629380, 3697985540, 3539115046,
                1875320260, 435987462, 3758699696, 225123190, 789314854, 4037132810, 2303494531,
                660670958, 930365774, 2280846889, 2037009405, 3398207748, 363483906, 1016500849,
                3065134416, 1773254833, 1419866801, 3032100639, 3151696086, 1546375883, 1467867223,
                647860061, 2017628388, 1966221567, 2719828919, 2202077904, 91202,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                2863444765, 320199946, 2544847741, 1466237955, 1178219077, 1315054824, 3771052967,
                238536200, 3051229956, 513400291, 1614125767, 655516730, 1273500364, 301152196,
                3415166075, 3905952109, 2017235653, 3197094661, 1739448994, 1841098802, 861712828,
                1365173002, 3026119278, 3916782096, 1474629320, 623752124, 4061599939, 2173840711,
                325889248, 2338211343, 2716438668, 167572548, 1207558298, 2257099011, 3870588799,
                2832931859, 3322475582, 1225633647, 407893672, 1051239542, 2338082198, 28384394,
            ],
        ),
    );
    let i = Ratio::new(
        BigInt::new(
            Sign::Plus,
            vec![
                720961536, 1220511417, 4214104891, 3020337201, 4094563799, 1663188853, 2518264202,
                563983485, 2729503177, 3731226174, 2915435247, 240640787, 3485138325, 1448467267,
                1577813516, 1363943784, 3231371652, 1955699644, 702422535, 3556575761, 3672688329,
                212404209, 796458559, 1629888642, 938422430, 2486792976, 853759027, 882830138,
                1693856992, 503677202, 1180919700, 1482998444, 2880862652, 578065208, 4129794108,
                3941500861, 2940265486, 2537593843, 1366149840, 341760214, 238,
            ],
        ),
        BigInt::new(
            Sign::Plus,
            vec![
                2863444765, 320199946, 2544847741, 1466237955, 1178219077, 1315054824, 3771052967,
                238536200, 3051229956, 513400291, 1614125767, 655516730, 1273500364, 301152196,
                3415166075, 3905952109, 2017235653, 3197094661, 1739448994, 1841098802, 861712828,
                1365173002, 3026119278, 3916782096, 1474629320, 623752124, 4061599939, 2173840711,
                325889248, 2338211343, 2716438668, 167572548, 1207558298, 2257099011, 3870588799,
                2832931859, 3322475582, 1225633647, 407893672, 1051239542, 2338082198, 28384394,
            ],
        ),
    );

    let coeffs = vec![a, b, c, d, e, f, g, h, i];

    for arg in std::env::args().skip(1) {
        let x = nu(&arg) / nu("4611686018427387904");
        let two = nu("2");

        let mut p3 = nu("1");
        let mut p2 = x.clone();
        let mut p1 = two.clone() * p2.clone() * x.clone() - p3.clone();
        let mut sum = nu("0");
        for i in 0..coeffs.len() {
            if i == 0 {
                sum += coeffs[i].clone() // is same a sum += ... * 1
            } else {
                p3 = p2;
                p2 = p1;
                p1 = p2.clone() * two.clone() * x.clone() - p3;
                sum += coeffs[i].clone() * p1.clone();
            }
        }

        println!("cos({}) = {}", nu(&arg), to_f64(sum).unwrap());
    }
}
